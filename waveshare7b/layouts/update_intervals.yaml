# update_intervals.yaml - Lightweight polling only
# All entity updates are now event-driven via on_value/on_state callbacks in common.yaml
# Only keypad display + WiFi/clock need polling

# Fast updates: keypad code display (needs instant feedback during typing)
- interval: 500ms
  then:
    - lambda: |-
        // Keypad Code Display
        std::string code = id(entered_code);
        std::string display = "";
        for (size_t i = 0; i < code.length() && i < 6; i++) display += "* ";
        if (display.empty()) display = "_ _ _ _";
        lv_label_set_text(id(code_display), display.c_str());

        // Alarm countdown (only when pending - needs fast refresh)
        if (id(alarm_state).has_state() && id(alarm_state).state == "pending") {
          const char* countdown = "Arming...";
          char buf[20];
          if (id(alarm_delay_time).has_state()) {
            int s = (int)id(alarm_delay_time).state;
            if (s > 0) { snprintf(buf, sizeof(buf), "%d seconds", s); countdown = buf; }
          }
          lv_label_set_text(id(alarm_countdown_detail), countdown);
          lv_label_set_text(id(alarm_countdown_main), countdown);
        }

# Slow polling: WiFi bars + clock (no HA callback available for these)
- interval: 30s
  then:
    - lambda: |-
        // WiFi Signal Bars
        float signal = id(wifi_signal_strength).state;
        lv_color_t green = lv_color_hex(0x30D158);
        lv_color_t gray  = lv_color_hex(0x8E8E93);
        lv_color_t c1 = green, c2 = gray, c3 = gray, c4 = gray;
        if (signal > -50) { c1 = c2 = c3 = c4 = green; }
        else if (signal > -60) { c1 = c2 = c3 = green; }
        else if (signal > -70) { c1 = c2 = green; }
        lv_obj_set_style_bg_color(id(wifi_bar_1), c1, 0);
        lv_obj_set_style_bg_color(id(wifi_bar_2), c2, 0);
        lv_obj_set_style_bg_color(id(wifi_bar_3), c3, 0);
        lv_obj_set_style_bg_color(id(wifi_bar_4), c4, 0);

        // Clock
        auto t = id(ha_time).now();
        if (t.is_valid()) {
          char buf[8];
          snprintf(buf, sizeof(buf), "%02d:%02d", t.hour, t.minute);
          lv_label_set_text(id(last_update_time), buf);
        }
